<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#106584">
    <title>Agenda</title>
    <link rel="stylesheet" href="css/agenda.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/remixicon/2.5.0/remixicon.css">
    <style>
        
    </style>
</head>

<body>
    <div id="app">
        <div class="top-nave">
            <h2>Agenda</h2>
        </div>
        <div class="corpo">
            <div class="cabecalho">
                <button id="anterior">
                    <i class="ri-arrow-left-line"></i>
                </button>
                <h3 id="nomeMes">Mês Atual</h3>
                <button id="proximo">
                    <i class="ri-arrow-right-line"></i>
                </button>
            </div>
            <ul class="dias" id="listaDias"></ul>
        </div>
    </div>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
        import { getFirestore, collection, query, where, getDocs } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBk3kzqpBKEyrwHdnC_RgHmd4PDUJOqoEU",
            authDomain: "copinfo-5a0f5.firebaseapp.com",
            projectId: "copinfo-5a0f5",
            storageBucket: "copinfo-5a0f5.appspot.com",
            messagingSenderId: "543026869888",
            appId: "1:543026869888:web:f2ef1ce629b2bf49615865",
            measurementId: "G-9JHXYXYKGT"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        function iniciarCalendario() {
            const dataAtual = new Date();
            let mesAtual = dataAtual.getMonth();
            let anoAtual = dataAtual.getFullYear();

            const meses = [
                "Janeiro", "Fevereiro", "Março", "Abril", "Maio", "Junho",
                "Julho", "Agosto", "Setembro", "Outubro", "Novembro", "Dezembro"
            ];

            const nomeMesElemento = document.querySelector('#nomeMes');
            const listaDiasElemento = document.querySelector('#listaDias');

            function atualizarMes() {
                nomeMesElemento.textContent = `${meses[mesAtual]} ${anoAtual}`;
                criarDias();
            }

            async function criarDias() {
                listaDiasElemento.innerHTML = '';
                const ultimoDiaDoMes = new Date(anoAtual, mesAtual + 1, 0).getDate();

                // Consultar eventos no Firestore
                const eventosQuery = query(
                    collection(db, "admins"),
                    where("data", ">", new Date(anoAtual, mesAtual, 1)),
                    where("data", "<", new Date(anoAtual, mesAtual + 1, 0))
                );
                const eventosSnapshot = await getDocs(eventosQuery);
                const eventos = eventosSnapshot.docs.map(doc => doc.data());

                for (let dia = 1; dia <= ultimoDiaDoMes; dia++) {
                    const diaElemento = document.createElement('li');
                    diaElemento.classList.add('dia');
                    let descricao = "Expediente";

                    // Verificar se há evento para o dia
                    const eventoDoDia = eventos.filter(evento => new Date(evento.data.seconds * 1000).getDate() === dia);

                    if (eventoDoDia.length > 0) {
                        descricao = eventoDoDia[0].descricao;
                    }

                    diaElemento.innerHTML = `
                        <div class="data">${dia}</div>
                        <div class="descricao">${descricao}</div>
                        <button class="botao-expandir">Detalhes</button>
                        <div class="expanded">
                            <p>${eventoDoDia.length > 0 ? eventoDoDia[0].detalhes : "Sem detalhes."}</p>
                        </div>
                    `;

                    diaElemento.querySelector('.botao-expandir').addEventListener('click', function () {
                        const expanded = diaElemento.querySelector('.expanded');
                        expanded.classList.toggle('show');
                    });

                    listaDiasElemento.appendChild(diaElemento);
                }
            }

            document.querySelector('#anterior').addEventListener('click', function () {
                if (mesAtual > 0) {
                    mesAtual--;
                } else {
                    mesAtual = 11;
                    anoAtual--;
                }
                atualizarMes();
            });

            document.querySelector('#proximo').addEventListener('click', function () {
                if (mesAtual < 11) {
                    mesAtual++;
                } else {
                    mesAtual = 0;
                    anoAtual++;
                }
                atualizarMes();
            });

            atualizarMes();
        }

        iniciarCalendario();
    </script>
</body>

</html>
